<!DOCTYPE html> 
<html lang="en"> 
<head>  
  <meta charset="utf-8" /> 
  <title>Ramallah Waste Containers</title>  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />  
  <style> 
    body { margin: 0; height: 100%; width: 100%; display: flex; flex-direction: column; }
    #map { flex: 1; position: relative; }
    .control-panel { background-color: #f8f9fa; padding: 10px; display: flex; gap: 10px; justify-content: center; border-bottom: 1px solid #ccc; }
    .floating-info { position: absolute; background-color: white; padding: 10px; border: 1px solid #ccc; border-radius: 5px; z-index: 1000; display: none; }
  </style>
</head>
<body>
  <div class="control-panel">
    <button id="togglePrediction">Toggle Waste Prediction</button>
    <button id="toggleNewContainers">Toggle New Container Suggestions</button>
    <button id="toggleRecyclingPoints">Toggle Recycling Points</button>
    <button id="toggleOptimalRoute">Toggle Optimal Route</button>
  </div>
  <div id="map"></div>
  <div class="floating-info" id="infoBox"></div>
  
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>
    const mapOptions = {
      zoomSnap: 0.5,
      center: [31.9045, 35.2045],
      zoom: 19,
    };
    const map = L.map("map", mapOptions);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap & CARTO',
      subdomains: 'abcd',
      maxZoom: 20
    }).addTo(map);

    let zonesLayer, wasteContainersLayer;
    let showPrediction = false;
    let showNewContainers = false;
    let showRecyclingPoints = false;
    let showOptimalRoute = false;

    // ميزة التنبؤ بالنفايات
    function toggleWastePrediction() {
      showPrediction = !showPrediction;
      if (wasteContainersLayer) {
        wasteContainersLayer.eachLayer(function(layer) {
          const wasteType = layer.feature.properties.TYPE_OF_WA;
          const prediction = showPrediction ? predictWastePattern() : "No Prediction";
          layer.bindPopup(`<strong>Material:</strong> ${wasteType} <br><strong>Prediction:</strong> ${prediction}`);
        });
      }
    }

    function predictWastePattern() {
      const usagePattern = Math.random();
      return usagePattern > 0.6 ? "High accumulation expected" : "Normal levels expected";
    }

    // ميزة اقتراح المواقع الجديدة للحاويات
    function toggleNewContainerSuggestions() {
      showNewContainers = !showNewContainers;
      if (zonesLayer) {
        zonesLayer.eachLayer(function(layer) {
          const centroid = layer.getBounds().getCenter();
          if (showNewContainers) {
            L.circleMarker(centroid, { radius: 6, fillColor: 'blue', color: 'blue', weight: 2, fillOpacity: 0.6 })
              .bindPopup("Suggested Container Location").addTo(map);
          }
        });
      }
    }

    // ميزة اقتراح نقاط إعادة التدوير
    function toggleRecyclingPoints() {
      showRecyclingPoints = !showRecyclingPoints;
      if (zonesLayer) {
        zonesLayer.eachLayer(function(layer) {
          if (showRecyclingPoints && layer.feature.properties.commonWasteType === "Plastic") {
            L.marker(layer.getBounds().getCenter(), { icon: L.divIcon({ className: 'recycling-icon', html: '♻' }) })
              .bindPopup("Suggested Recycling Point for Plastic").addTo(map);
          }
        });
      }
    }

    // ميزة حساب المسار الأمثل
    function toggleOptimalRoute() {
      showOptimalRoute = !showOptimalRoute;
      if (wasteContainersLayer && showOptimalRoute) {
        const containers = wasteContainersLayer.getLayers();
        for (let i = 0; i < containers.length - 1; i++) {
          L.polyline(
            [containers[i].getLatLng(), containers[i + 1].getLatLng()],
            {
              color: 'blue',
              weight: 2,
              opacity: 0.5
            }
          ).addTo(map).bindPopup("Suggested collection path");
        }
      }
    }

    // تحميل البيانات وإضافة الطبقات
    $.getJSON("RamallahZones.json", function(RZ) {
      zonesLayer = L.geoJson(RZ, {
        style: function(feature) {
          return {
            fillColor: "green",
            fillOpacity: 0.3,
            color: "green",
            weight: 1.0,
            opacity: 0.7
          };
        },
      }).addTo(map);
    });

    $.getJSON("wasteContainer.json", function(WC) {
      wasteContainersLayer = L.geoJson(WC, {
        pointToLayer: function(feature, latlng) {
          return L.circleMarker(latlng, { radius: 5, fillColor: 'orange', color: 'orange', weight: 1, opacity: 1, fillOpacity: 0.8 });
        }
      }).addTo(map);
    });

    // إضافة أحداث الأزرار للتحكم بالميزات
    document.getElementById("togglePrediction").onclick = toggleWastePrediction;
    document.getElementById("toggleNewContainers").onclick = toggleNewContainerSuggestions;
    document.getElementById("toggleRecyclingPoints").onclick = toggleRecyclingPoints;
    document.getElementById("toggleOptimalRoute").onclick = toggleOptimalRoute;

  </script>
</body>
</html>

